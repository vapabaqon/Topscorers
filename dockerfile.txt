# Use an official Python runtime as a parent image
FROM python:3.9-slim

# Install Supervisor
RUN apt-get update && apt-get install -y supervisor

# Set the working directory
WORKDIR /app

# Copy your Python script into the container
COPY sesrvices /app/sesrvices
COPY utils /app/utils
COPY config.py /app/
COPY mainpy.py /app/
COPY credentials.json /app/

# Install the required libraries
RUN pip install certifi==2023.7.22 charset-normalizer==3.3.0 idna==3.4 requests==2.31.0 urllib3==2.0.6

# Create a Supervisor configuration file for your script
RUN echo "[program:my-python-script]" >> /etc/supervisor/conf.d/my-python-script.conf
RUN echo "command=python /app/your_script.py" >> /etc/supervisor/conf.d/my-python-script.conf
RUN echo "autostart=true" >> /etc/supervisor/conf.d/my-python-script.conf
RUN echo "autorestart=true" >> /etc/supervisor/conf.d/my-python-script.conf
RUN echo "startsecs=0" >> /etc/supervisor/conf.d/my-python-script.conf
RUN echo "starttime=03:00" >> /etc/supervisor/conf.d/my-python-script.conf
RUN echo "stopwaitsecs=3600" >> /etc/supervisor/conf.d/my-python-script.conf

# Start Supervisor
CMD ["/usr/bin/supervisord", "-n", "-c", "/etc/supervisor/supervisord.conf"]
